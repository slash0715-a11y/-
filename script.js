// script.js (請用此內容完全替換原有的所有內容)

'use strict'; 

// --- 預設清單資料 (最終版本，不含自訂清單，吃到飽已移除前兩項) ---
const PRESET_MEALS = {
    // 清單 1: 台灣小吃 
    "小吃": [
        "滷肉飯", "牛肉麵", "蚵仔煎", "珍珠奶茶", "擔仔麵", "生煎包", 
        "油粿", "菱角酥", "甜不辣 (黑輪)", "肉圓", "炸雞排", "蔥抓餅", 
        "蚵仔麵線", "臭豆腐", "烤地瓜", "胡椒餅", "小籠包", 
        "魚丸湯", "藥燉排骨", "鵝肉切盤", "鼎邊銼", "麻糬", "加熱滷味", 
        "筒仔米糕", "豆漿店", "豬血湯", "鹽水雞", "切仔麵", "麻辣臭豆腐", 
        "粄條", "米粉湯", "皮蛋豆腐", "潤餅", "三媽", "冷滷", 
        "大腸包小腸", "肉粽", "肉羹麵", "車輪餅 (紅豆餅)", "普林斯草仔粿", 
        "豬血糕", "鹽酥雞", "竹筒飯", "碗粿", "鹹粥", "割包", "油飯", 
        "地瓜球", "肉粽", "炸彈蔥油餅", "水煎包", "蒸餃", "牛肉麵", 
        "魯肉飯 (不同口味)"
    ],
    // 清單 2: 便當/簡餐 
    "便當/簡餐": [
        "排骨便當", "雞腿便當 (炸)", "控肉便當", "三寶飯", "蜜汁叉燒飯", 
        "烤雞腿飯", "椒麻雞飯", "魚排便當 (鯖魚)", "三杯雞飯", "宮保雞丁飯", 
        "台式炒飯", "廣州炒麵", "咖哩飯", "牛肉蓋飯", "豬排蛋包飯", 
        "義大利肉醬麵", "奶油培根義大利麵", "焗烤飯", "鍋燒意麵", "海鮮烏龍麵", 
        "韓式石鍋拌飯", "韓式泡菜炒豬肉飯", "鐵板麵套餐", "素食自助餐便當", 
        "自助餐便當", "日式豬排定食", "日式炸蝦飯", "泰式打拋豬肉飯", 
        "泰式綠咖哩飯", "廣式炒河粉", "汕頭炒麵", "沙茶牛肉炒麵", "炒青菜套餐", 
        "滷雞腿飯", "滷排骨飯", "鰻魚飯 (平價)", "烤肉飯", "鴨肉飯", 
        "當歸鴨麵線", "火雞肉飯套餐", "羊肉燴飯", "蔥爆牛肉飯", "牛肉炒麵", 
        "什錦炒麵/飯", "榨菜肉絲麵", "紅燒牛肉湯餃", "鮮魚湯飯", "麻油雞飯", 
        "炒碼麵", "海產粥"
    ],
    // 清單 3: 便利商店鮮食 
    "便利商店": [
        "義式肉醬千層麵", "國民便當", "辣味雞腿咖哩飯", "韓式泡菜鍋 (微波)", 
        "泰式綠咖哩飯 (鮮食)", "麻醬涼麵 (夏季)", "川味麻辣燙 (微波)", 
        "日式和風咖哩飯", "蒜辣雞排義大利麵", "白醬海鮮義大利麵", 
        "培根起司蛋包飯", "壽喜燒牛肉飯", "烤多蛋白餐盒 (全家)", 
        "鼎泰豐雞肉香辣醬炒麵", "鮮筍排骨湯 (媽媽煮藝)", "香菇雞湯 (媽媽煮藝)", 
        "御料小館泡菜冬粉", "御料小館泡菜鍋貼", "經典奮起湖便當 (7-11)", 
        "韓式辣炒年糕", "港式公仔麵 (微波)", "日式叉燒拉麵 (微波)", 
        "涼麵 (蒜味/日式)", "經典三明治", "飯糰 (鮪魚/肉鬆)", "熱狗堡", 
        "關東煮", "烤雞腿沙拉", "牛肉捲餅", "豬肉餡餅", "蔥油雞飯", 
        "壽司組合", "凱薩雞肉沙拉", "義大利肉醬焗飯", "宮保雞丁炒飯", 
        "港式煲仔飯 (微波)", "墨西哥捲餅", "雙色地瓜起司", "烤多蛋白餐盒", 
        "佛跳牆 (個人微波版)", "台式炒米粉", "炒麵 (便利商店)", 
        "蒸蛋湯", "鍋貼/水餃 (微波)", "烤雞胸肉 (單品)", "滷味拼盤 (微波)", 
        "鹹酥雞 (微波盒裝)", "壽司手卷", "雞肉藜麥便當", "鮪魚義大利麵沙拉"
    ],
    // 清單 4: NT$200-500 低價位餐廳
    "低價位餐廳": [
        "義大利麵", "燉飯套餐", "平價披薩店（單點）", "連鎖咖啡廳簡餐", 
        "早午餐店主餐", "日式拉麵", "咖哩飯", "韓式豆腐鍋", 
        "越式河粉", "泰式炒河粉", "港式燒臘飯", "個性化小火鍋", 
        "石鍋拌飯", "鐵板燒套餐（平價店）", "厚片牛排（非套餐）", 
        "質感升級的牛肉麵店套餐", "特色滷肉飯/雞肉飯套餐", 
        "地方特色料理店（單點）", "速食店高階套餐", "連鎖簡餐店（如三商巧福升級）", 
        "連鎖咖啡廳輕食", "義式肉醬千層麵", "經典漢堡套餐", "精緻排骨飯", 
        "泰式椒麻雞飯", "焗烤飯麵（非單點）", "韓式炸雞套餐", 
        "大份量簡餐沙拉", "墨西哥捲餅套餐", "美式潛艇堡", "健康餐盒", 
        "輕食沙拉吧（單次）", "自助餐便當（豪華版）", "日式豬排咖哩飯", 
        "炒飯專賣店特色炒飯", "鍋燒麵套餐", "廣東粥與腸粉套餐", 
        "義式薄餅", "窯烤麵包店簡餐", "素食主題套餐", "地方特色麵食（大份）",
        "韓式部隊鍋（單人）", "連鎖泰式麵食", "特色水餃鍋貼套餐", 
        "日式丼飯（高階款）", "台式簡餐合菜（單人份）", "特色小籠包湯包套餐",
        "印度烤餅套餐", "異國風味咖哩（單點）", "手作甜點與飲料套餐"
    ],
    // 清單 5: NT$500-2000 中高價位餐廳 
    "中高價位餐廳": [
        "精緻排餐", "法式套餐", "義式套餐", "高級牛排館午間套餐", 
        "異國料理主廚套餐", "高品質生魚片丼飯", "握壽司套餐", 
        "鰻魚飯SET", "鐵板燒", "頂級麻辣鍋單點", "高級個人小火鍋套餐", 
        "中價位韓式燒肉單點", "日式烤肉單點", "精選烤鴨半隻/一隻", 
        "高檔港式點心套餐", "精緻上海菜", "新式台菜熱炒", "精品泰式料理套餐", 
        "精緻印度料理", "海鮮餐廳（單點）", "特色西班牙菜", "頂級和牛壽喜燒（單點）", 
        "法式鹹派套餐", "米其林推薦小店主餐", "Omakase無菜單料理", 
        "高空景觀餐廳套餐", "創意亞洲料理", "豪華龍蝦湯", "乾式熟成牛排（單點）",
        "海陸雙拼套餐", "日本料理懷石套餐", "高階義式手工麵", "經典威靈頓牛排",
        "精品咖啡與輕食（高價）", "高檔茶藝館套餐", "手工精釀啤酒與炸物拼盤", 
        "特色分子料理", "主廚推薦海鮮燉飯", "高級日式串炸", "魚翅/鮑魚套餐", 
        "精緻粵菜", "南洋風味套餐（精緻）",
        "私人廚房預約制料理", "高檔素食饗宴", "頂級燒肉組合套餐", 
        "特色紅酒燉牛肉", "精選葡萄酒與起司盤"
    ],
    // 清單 6: 吃到飽專區 (共 98 項)
    "吃到飽": [
        "漢來海港餐廳 (多區)", 
        "探索廚房 (台北寒舍艾美)", "喜來登-十二廚 (台北)", "W 飯店-The Kitchen Table (台北)", 
        "台北遠東-遠東Café (台北)", "萬豪酒店-花園廚房 (台北)", "新板希爾頓-悅市集 (新北)", 
        "台北文華東方-文華Café (台北)", "欣葉日本料理 (多區)", "豐FOOD 海陸百匯 (台北)", 
        "國泰萬怡-MJ Kitchen (台北)", "台北花園大酒店-饗聚廚房 (台北)", "凱撒飯店-Checkers (台北)", 
        "高雄承億酒店-日全食 (高雄)", "台中裕元花園-溫莎咖啡廳 (台中)", "台南晶英-Robins (台南)", 
        "寒沐酒店-MU TABLE (宜蘭)", "新竹國賓-八方燴 (新竹)", "兆品酒店-品東西Buffet (嘉義)", 
        "台中林酒店-森林百匯 (台中)", "台北美福-彩匯自助餐廳 (台北)", "台北君悅-凱菲屋 Café (台北)", 
        "晶華酒店-栢麗廳 (台北)", "台中金典-栢麗廳 (台中)", "礁溪老爺-雲天自助餐 (宜蘭)", 
        "煙波大飯店-莫內西餐廳 (新竹)", "桃園喜來登-優廚西餐廳 (桃園)", "台南大員皇冠假日-元素 (台南)", 
        "高雄國賓-愛河牛排海鮮 (高雄)", "台北晶華-Azie Grand Café (台北)", "高雄義大皇家-星亞自助餐 (高雄)", 
        "台北寒舍艾麗-La Farfalla (台北)", "台北福華-彩虹座 (台北)", "台北圓山飯店-松鶴廳 (台北)", 
        "台中日月千禧-饗樂全日餐廳 (台中)", "台北美麗信-光廊Café (台北)", "台北花園大酒店-六國餐廳 (台北)", 
        "台中長榮桂冠-咖啡廳 (台中)", "燒肉眾精緻炭火燒肉 (多區)", "咚咚家韓式豬肉專賣店 (台北)", 
        "燒肉 Smile (多區)", "築間燒肉 (多區)", "戰火燒肉 (台北)", 
        "燒肉吃到飽-燒肉同話 (多區)", "笨堂燒肉 (台北)", "田季發爺燒肉 (多區)", 
        "我!就厲害 (多區)", "壽喜燒一丁 (多區)", "燒肉殿 (台北)", 
        "牛角日本燒肉專門店 (多區)", "小蒙牛頂級麻辣養生鍋 (多區)", "大喜鍋 (多區)", 
        "韓式烤肉吃到飽-肉次方 (多區)", "馬太郎燒肉 (台北)", "兩餐韓國年糕火鍋 (多區)", 
        "饗食天堂 (多區)", "羊角炭火燒肉 (台北)", "炙作超好吃燒肉 (新北)", 
        "熊一燒肉 (台北)", "八色烤肉 (台北)", "涮乃葉 (多區)", 
        "椒心苑麻辣鍋 (台北)", "瓦崎燒肉 (台北)", "馬辣頂級麻辣鴛鴦火鍋 (多區)", 
        "泰市場 (台北)", "小福利麻辣鍋 (多區)", "涮辛酸 (台北)", 
        "千葉火鍋 (多區)", "瘋一鍋頂鮮鍋物 (多區)", "醉好蝦 (台北)", 
        "辛殿麻辣鍋 (多區)", "天外天精緻麻辣火鍋 (多區)", "玖樓吃到飽 (台北)", 
        "新馬辣經典麻辣鍋 (多區)", "醉麻辣 (台北)", "石頭日式炭火燒肉 (多區)", 
        "向心爐 (高雄)", "大漠韓式烤肉 (新竹)", "吃到飽-串燒殿 (多區)", 
        "吃到飽-宮廷御膳 (高雄)",
        "韓式烤肉-姜虎東白丁 (台北)", "海霸王-甲天下自助餐 (台北)", 
        "鬥牛士二鍋 (多區)", "蒸霸天下-蒸氣海鮮 (台北)", "醉麻辣 (高雄)",
        "銅盤韓國烤肉 (多區)", "大戈壁蒙古烤肉 (台北)", "台北福容-田園咖啡廳 (台北)",
        "台中永豐棧-風尚自助餐 (台中)", "台南桂田酒店-阿力海 (台南)",
        "星享道-星饗道國際自助餐 (台中)", "台南香格里拉-遠東Café (台南)",
        "林皇宮-LV森林百匯 (台中)", "高雄萬豪-豪享自助餐 (高雄)", 
        "台北花園-六國餐廳 (台北)", "晶悅國際飯店-愛麗絲百匯 (桃園)",
        "華泰王子大飯店-九華樓 (台北)", "台北天成大飯店-百合咖啡廳 (台北)",
        "桃園尊爵大飯店-四季咖啡廳 (桃園)", "台中兆品酒店-品東西 (台中)",
        "嘉義耐斯王子-萬國百匯 (嘉義)", "高雄翰品酒店-品日式料理 (高雄)",
        "台北時代寓所-The Chorus (台北)", "台北艾麗酒店-The Terrace (台北)"
    ]
};

// --- 主要邏輯 (用 DOMContentLoaded 確保元素載入) ---
document.addEventListener('DOMContentLoaded', () => {
    // --- DOM 元素獲取 ---
    const pickBtn = document.getElementById('pick-btn');
    const resultText = document.getElementById('result-text'); 
    const mealCountSpan = document.getElementById('meal-count');
    const categoryPicker = document.getElementById('category-picker'); 

    // --- 狀態管理 ---
    let currentCategory = categoryPicker.value;
    let meals = []; 
    let pickTimeout;

    /**
     * 函式：更新清單數量
     */
    function updateMealCount() {
        if (mealCountSpan) {
            mealCountSpan.textContent = meals.length;
        }
    }

    /**
     * 函式：根據選定的類別，設定當前的 meals 陣列
     */
    function switchCategory(category) {
        currentCategory = category;
        
        // 只從 PRESET_MEALS 載入清單
        meals = PRESET_MEALS[category] ? [...PRESET_MEALS[category]] : [];
        
        updateMealCount();
        
        // 重設結果文字
        resultText.innerHTML = "點擊按鈕，為您決定今日美食！";
        resultText.classList.remove('highlight');
    }

    /**
     * 函式：執行隨機選擇
     */
    function pickRandomMeal() {
        // 清除前一次的定時器和動畫
        if (pickTimeout) {
            clearTimeout(pickTimeout);
            resultText.classList.remove('highlight');
        }
        
        // 檢查清單是否為空
        if (meals.length === 0) {
            resultText.textContent = "清單為空：請先選擇一個有菜單的類別！";
            resultText.classList.add('highlight');
            
            // 錯誤訊息短暫顯示 1 秒後恢復預設提示
            pickTimeout = setTimeout(() => {
                resultText.classList.remove('highlight');
                resultText.textContent = "點擊按鈕，為您決定今日美食！"; 
                pickTimeout = null; 
            }, 1000); 
            return;
        }
        
        // 立即選定
        const finalIndex = Math.floor(Math.random() * meals.length);
        const selectedMeal = meals[finalIndex];

        // 顯示結果與動畫
        resultText.innerHTML = `今日最終選擇：<br><strong>${selectedMeal}</strong>`;
        resultText.classList.add('highlight'); 

        // 1 秒後只移除閃爍效果，結果常駐
        pickTimeout = setTimeout(() => {
            resultText.classList.remove('highlight');
            pickTimeout = null; 
        }, 1000); 
    }

    // --- 事件監聽器 ---

    categoryPicker.addEventListener('change', (e) => {
        switchCategory(e.target.value);
    });

    pickBtn.addEventListener('click', pickRandomMeal);

    // 網頁載入時初始化：根據 HTML 中 <select> 的預設值載入清單
    switchCategory(categoryPicker.value);
});